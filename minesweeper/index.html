<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>iPad ÁªèÂÖ∏Êâ´Èõ∑</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <style>
        :root {
            --bg-color: #e0e0e0;
            --cell-size: 40px;
            --font-size: 20px;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background-color: var(--bg-color);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            user-select: none;
            touch-action: manipulation;
        }
        #status-bar {
            margin-bottom: 20px;
            font-size: 24px;
            font-weight: bold;
            display: flex;
            gap: 40px;
        }
        #board {
            display: grid;
            gap: 2px;
            padding: 10px;
            background-color: #999;
            border: 4px inset #fff;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .cell {
            width: var(--cell-size);
            height: var(--cell-size);
            background-color: #bdbdbd;
            border: 3px outset #eee;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: var(--font-size);
            font-weight: bold;
            cursor: pointer;
        }
        .cell.revealed {
            background-color: #d1d1d1;
            border: 1px solid #999;
        }
        .cell.mine { background-color: #ff4d4d; }
        .cell.flagged::after { content: "üö©"; }
        .n1 { color: blue; } .n2 { color: green; } .n3 { color: red; }
        button {
            margin-top: 30px;
            padding: 10px 20px;
            font-size: 18px;
            border-radius: 8px;
            border: none;
            background: #007aff;
            color: white;
        }
    </style>
</head>
<body>

<div id="status-bar">
    <div>üí£ <span id="mine-count">10</span></div>
    <div id="timer">‚è±Ô∏è 0</div>
</div>

<div id="board"></div>

<button onclick="initGame()">ÈáçÊñ∞ÂºÄÂßã</button>

<script>
    const rows = 10, cols = 10, minesCount = 10;
    let board = [], revealedCount = 0, gameOver = false, timerInterval;

    function initGame() {
        const boardElement = document.getElementById('board');
        boardElement.style.gridTemplateColumns = `repeat(${cols}, var(--cell-size))`;
        boardElement.innerHTML = '';
        board = []; revealedCount = 0; gameOver = false;
        document.getElementById('mine-count').innerText = minesCount;
        clearInterval(timerInterval);
        document.getElementById('timer').innerText = "‚è±Ô∏è 0";

        // ÂàõÂª∫Êï∞ÊçÆÁªìÊûÑ
        for (let r = 0; r < rows; r++) {
            board[r] = [];
            for (let c = 0; c < cols; c++) {
                const cell = { r, c, mine: false, revealed: false, flagged: false, count: 0 };
                board[r][c] = cell;
                const div = document.createElement('div');
                div.className = 'cell';
                div.id = `cell-${r}-${c}`;
                
                // Ê†∏ÂøÉ‰∫§‰∫íÔºöÁü≠ÊåâÂºÄÂêØÔºåÈïøÊåâÊèíÊóó
                let touchTimer;
                div.addEventListener('touchstart', (e) => {
                    if (gameOver) return;
                    touchTimer = setTimeout(() => {
                        toggleFlag(cell);
                        touchTimer = null;
                    }, 400); // ÈïøÊåâ 400ms ÊèíÊóó
                });
                div.addEventListener('touchend', (e) => {
                    if (touchTimer) {
                        clearTimeout(touchTimer);
                        revealCell(cell);
                    }
                    e.preventDefault();
                });
                // ÂÖºÂÆπ PC ÁÇπÂáª
                div.onclick = () => revealCell(cell);
                div.oncontextmenu = (e) => { e.preventDefault(); toggleFlag(cell); };

                boardElement.appendChild(div);
            }
        }

        // Â∏ÉÈõ∑
        let planted = 0;
        while (planted < minesCount) {
            let r = Math.floor(Math.random() * rows), c = Math.floor(Math.random() * cols);
            if (!board[r][c].mine) {
                board[r][c].mine = true;
                planted++;
            }
        }

        // ËÆ°ÁÆóÊï∞Â≠ó
        for (let r = 0; r < rows; r++) {
            for (let c = 0; c < cols; c++) {
                if (board[r][c].mine) continue;
                let count = 0;
                for (let i = -1; i <= 1; i++) {
                    for (let j = -1; j <= 1; j++) {
                        if (board[r+i]?.[c+j]?.mine) count++;
                    }
                }
                board[r][c].count = count;
            }
        }
        startTimer();
    }

    function revealCell(cell) {
        if (gameOver || cell.revealed || cell.flagged) return;
        cell.revealed = true;
        const el = document.getElementById(`cell-${cell.r}-${cell.c}`);
        el.classList.add('revealed');

        if (cell.mine) {
            el.innerText = "üí£";
            endGame(false);
            return;
        }

        if (cell.count > 0) {
            el.innerText = cell.count;
            el.classList.add('n' + cell.count);
        } else {
            // ÈÄíÂΩíÊâìÂºÄÁ©∫Ê†º
            for (let i = -1; i <= 1; i++) {
                for (let j = -1; j <= 1; j++) {
                    if (board[cell.r+i]?.[cell.c+j]) revealCell(board[cell.r+i][cell.c+j]);
                }
            }
        }

        revealedCount++;
        if (revealedCount === rows * cols - minesCount) endGame(true);
    }

    function toggleFlag(cell) {
        if (gameOver || cell.revealed) return;
        cell.flagged = !cell.flagged;
        document.getElementById(`cell-${cell.r}-${cell.c}`).classList.toggle('flagged');
    }

    function startTimer() {
        let s = 0;
        timerInterval = setInterval(() => {
            s++;
            document.getElementById('timer').innerText = "‚è±Ô∏è " + s;
        }, 1000);
    }

    function endGame(win) {
        gameOver = true;
        clearInterval(timerInterval);
        alert(win ? "üéâ ‰Ω†Ëµ¢‰∫ÜÔºÅ" : "üí• Ë∏©Âà∞Èõ∑‰∫ÜÔºÅ");
    }

    initGame();
</script>

</body>
</html>