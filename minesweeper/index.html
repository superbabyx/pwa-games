<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>iPad ç»å…¸æ‰«é›· - Win95 é£æ ¼</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <style>
        :root {
            --bg-color: #bdbdbd;
            --win-gray: #c0c0c0;
            --cell-size: 45px; /* ç¨å¾®åŠ å¤§ä¸€ç‚¹æ–¹ä¾¿ iPad è§¦æ‘¸ */
        }
        body {
            font-family: "MS Sans Serif", Tahoma, sans-serif;
            background-color: #008080; /* Win95 æ¡Œé¢ç»¿ */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            /* å…³é”®ï¼šç¦ç”¨ iPad ç³»ç»Ÿäº¤äº’ */
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
            touch-action: none;
        }
        #game-container {
            background-color: var(--bg-color);
            padding: 10px;
            border: 3px outset #eee;
            box-shadow: 2px 2px 10px rgba(0,0,0,0.5);
        }
        #status-bar {
            background: var(--bg-color);
            border: 3px inset #eee;
            margin-bottom: 10px;
            padding: 5px 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-family: 'Courier New', Courier, monospace;
            font-weight: bold;
            font-size: 24px;
            color: red;
            background: black;
        }
        #board {
            display: grid;
            gap: 0;
            border: 3px inset #eee;
        }
        .cell {
            width: var(--cell-size);
            height: var(--cell-size);
            background-color: #bdbdbd;
            border: 3px outset #eee;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            font-weight: bold;
            box-sizing: border-box;
            /* ç¦ç”¨å•å…ƒæ ¼é«˜äº® */
            -webkit-user-select: none;
            touch-action: none;
        }
        .cell.revealed {
            background-color: #d1d1d1;
            border: 1px solid #777;
        }
        .cell.mine { background-color: #ff4d4d; }
        .cell.flagged::after { content: "ğŸš©"; }
        .n1 { color: blue; } .n2 { color: green; } .n3 { color: red; } .n4 { color: darkblue; }
        
        button {
            margin-top: 20px;
            padding: 8px 20px;
            font-family: "MS Sans Serif", Tahoma, sans-serif;
            background: var(--bg-color);
            border: 2px outset #eee;
            font-weight: bold;
        }
        button:active { border-style: inset; }
    </style>
</head>
<body>

<div id="game-container">
    <div id="status-bar">
        <div id="mine-count">010</div>
        <div id="timer">000</div>
    </div>
    <div id="board"></div>
</div>

<button onclick="initGame()">é‡æ–°å¼€å§‹ (New Game)</button>

<script>
    const rows = 10, cols = 10, minesCount = 10;
    let board = [], revealedCount = 0, flaggedCount = 0, gameOver = false, timerInterval, time = 0;

    function initGame() {
        const boardElement = document.getElementById('board');
        boardElement.style.gridTemplateColumns = `repeat(${cols}, var(--cell-size))`;
        boardElement.innerHTML = '';
        board = []; revealedCount = 0; flaggedCount = 0; gameOver = false; time = 0;
        
        updateMineCounter();
        clearInterval(timerInterval);
        document.getElementById('timer').innerText = "000";

        for (let r = 0; r < rows; r++) {
            board[r] = [];
            for (let c = 0; c < cols; c++) {
                const cell = { r, c, mine: false, revealed: false, flagged: false, count: 0 };
                board[r][c] = cell;
                const div = document.createElement('div');
                div.className = 'cell';
                div.id = `cell-${r}-${c}`;
                
                let touchTimer;
                // iPad ä¸“ç”¨è§¦æ‘¸é€»è¾‘
                div.addEventListener('touchstart', (e) => {
                    if (gameOver) return;
                    touchTimer = setTimeout(() => {
                        toggleFlag(cell);
                        touchTimer = null;
                    }, 350); // 350ms è§¦å‘æ’æ——
                }, { passive: true });

                div.addEventListener('touchend', (e) => {
                    if (touchTimer) {
                        clearTimeout(touchTimer);
                        revealCell(cell);
                    }
                    e.preventDefault();
                }, { passive: false });

                // å…¼å®¹ PC
                div.onclick = () => { if(!window.ontouchstart) revealCell(cell); };
                div.oncontextmenu = (e) => { e.preventDefault(); toggleFlag(cell); };

                boardElement.appendChild(div);
            }
        }

        // å¸ƒé›·
        let planted = 0;
        while (planted < minesCount) {
            let r = Math.floor(Math.random() * rows), c = Math.floor(Math.random() * cols);
            if (!board[r][c].mine) {
                board[r][c].mine = true;
                planted++;
            }
        }

        // è®¡ç®—å‘¨å›´æ•°å­—
        for (let r = 0; r < rows; r++) {
            for (let c = 0; c < cols; c++) {
                if (board[r][c].mine) continue;
                let count = 0;
                for (let i = -1; i <= 1; i++) {
                    for (let j = -1; j <= 1; j++) {
                        if (board[r+i]?.[c+j]?.mine) count++;
                    }
                }
                board[r][c].count = count;
            }
        }
        startTimer();
    }

    function revealCell(cell) {
        if (gameOver || cell.revealed || cell.flagged) return;
        cell.revealed = true;
        revealedCount++;
        const el = document.getElementById(`cell-${cell.r}-${cell.c}`);
        el.classList.add('revealed');

        if (cell.mine) {
            el.innerText = "ğŸ’£";
            endGame(false);
            return;
        }

        if (cell.count > 0) {
            el.innerText = cell.count;
            el.classList.add('n' + cell.count);
        } else {
            for (let i = -1; i <= 1; i++) {
                for (let j = -1; j <= 1; j++) {
                    if (board[cell.r+i]?.[cell.c+j]) revealCell(board[cell.r+i][cell.c+j]);
                }
            }
        }
        checkWin();
    }

    function toggleFlag(cell) {
        if (gameOver || cell.revealed) return;
        cell.flagged = !cell.flagged;
        flaggedCount += cell.flagged ? 1 : -1;
        document.getElementById(`cell-${cell.r}-${cell.c}`).classList.toggle('flagged');
        updateMineCounter();
        checkWin();
    }

    function updateMineCounter() {
        let display = Math.max(0, minesCount - flaggedCount);
        document.getElementById('mine-count').innerText = display.toString().padStart(3, '0');
    }

    function checkWin() {
        // èƒœåˆ©æ¡ä»¶ï¼š
        // 1. æ‰€æœ‰éé›·æ ¼å­éƒ½è¢«ç¿»å¼€ (revealedCount === æ€»æ ¼å­ - é›·æ•°)
        // 2. æ‰€æœ‰é›·éƒ½è¢«æ ‡è®° (flaggedCount === minesCount) ä¸” æ ‡è®°çš„å…¨éƒ¨æ˜¯é›·
        const allCleared = (revealedCount === (rows * cols - minesCount));
        
        // ä¸¥æ ¼æ£€æŸ¥ï¼šæ˜¯å¦æ‰€æœ‰é›·éƒ½è¢«æ’æ——äº†
        let allMinesFlagged = true;
        for (let r = 0; r < rows; r++) {
            for (let c = 0; c < cols; c++) {
                if (board[r][c].mine && !board[r][c].flagged) allMinesFlagged = false;
            }
        }

        if (allCleared && allMinesFlagged) {
            endGame(true);
        }
    }

    function startTimer() {
        timerInterval = setInterval(() => {
            time++;
            document.getElementById('timer').innerText = time.toString().padStart(3, '0');
        }, 1000);
    }

    function endGame(win) {
        gameOver = true;
        clearInterval(timerInterval);
        // æ˜¾ç¤ºæ‰€æœ‰åœ°é›·
        for (let r = 0; r < rows; r++) {
            for (let c = 0; c < cols; c++) {
                if (board[r][c].mine) {
                    document.getElementById(`cell-${r}-${c}`).innerText = "ğŸ’£";
                }
            }
        }
        setTimeout(() => alert(win ? "ğŸš© æ­å–œï¼ä½ æ‰«æ¸…äº†æ‰€æœ‰åœ°é›·ï¼" : "ğŸ’¥ ç‚¸å¼¹çˆ†ç‚¸äº†ï¼Œæ¸¸æˆç»“æŸã€‚"), 100);
    }

    initGame();
</script>

</body>
</html>