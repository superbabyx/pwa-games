<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Retro PWA Arcade</title>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <style>
        :root {
            --win-teal: #008080;
            --win-gray: #c0c0c0;
            --win-border-light: #ffffff;
            --win-border-dark: #808080;
            --win-blue: #000080;
        }

        body {
            background-color: var(--win-teal);
            margin: 0;
            padding: 20px;
            font-family: "MS Sans Serif", Tahoma, sans-serif;
            user-select: none;
            overflow: hidden;
            height: 100vh;
        }

        /* æ¡Œé¢å›¾æ ‡å¸ƒå±€ */
        #desktop {
            display: grid;
            grid-template-columns: repeat(auto-fill, 90px);
            grid-template-rows: repeat(auto-fill, 100px);
            gap: 20px;
            align-content: start;
        }

        .icon {
            display: flex;
            flex-direction: column;
            align-items: center;
            text-decoration: none;
            color: white;
            text-align: center;
            outline: none;
        }

        .icon-box {
            width: 42px;
            height: 42px;
            margin-bottom: 8px;
            background: var(--win-gray);
            border: 2px outset #eee;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
            box-shadow: 1px 1px 0 #000;
        }

        .icon span {
            font-size: 11px;
            padding: 2px 4px;
            letter-spacing: 0.5px;
            word-break: break-all;
            max-width: 85px;
        }

        /* æ¨¡æ‹Ÿé€‰ä¸­æ•ˆæœ */
        .icon:focus span, .icon:active span {
            background-color: var(--win-blue);
            outline: 1px dotted #fff;
        }

        /* åº•éƒ¨ä»»åŠ¡æ  */
        .taskbar {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            height: 35px;
            background: var(--win-gray);
            border-top: 2px solid var(--win-border-light);
            display: flex;
            align-items: center;
            padding: 2px;
            z-index: 100;
            box-shadow: inset 1px 1px #dfdfdf;
        }

        .start-button {
            height: 28px;
            padding: 0 8px;
            border: 2px outset #eee;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 4px;
            background: var(--win-gray);
            font-size: 13px;
        }

        .start-button:active {
            border-style: inset;
            padding: 2px 6px 0 10px;
        }

        .system-tray {
            margin-left: auto;
            border: 2px inset #eee;
            padding: 0 10px;
            height: 24px;
            display: flex;
            align-items: center;
            font-size: 12px;
            background: var(--win-gray);
        }

        /* åŠ è½½çŠ¶æ€æŒ‡ç¤ºå™¨ */
        #loading-msg {
            color: white;
            font-size: 14px;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
    </style>
</head>
<body>

<div id="loading-msg">æ­£åœ¨æ‰«æç£ç›˜ C: ...</div>
<div id="desktop"></div>

<div class="taskbar">
    <div class="start-button">
        <img src="https://win98icons.alexmeub.com/icons/png/windows-0.png" width="16" alt="">
        Start
    </div>
    <div class="system-tray" id="clock">12:00 PM</div>
</div>

<script>
    // é…ç½®åŒºåŸŸ
    const CONFIG = {
        username: "superbabyx", // ã€é‡è¦ã€‘è¯·ä¿®æ”¹ä¸ºä½ çš„ GitHub ç”¨æˆ·å
        repo: "pwa-games",
        exclude: ["assets", "css", "js", "img", ".github"] // å¿½ç•¥è¿™äº›æ–‡ä»¶å¤¹
    };

    // è‡ªåŠ¨ä¸ºå¸¸è§æ¸¸æˆåŒ¹é…å›¾æ ‡
    const ICON_MAP = {
        "minesweeper": "ğŸ’£",
        "tetris": "ğŸ§±",
        "snake": "ğŸ",
        "2048": "ğŸ”¢",
        "default": "ğŸ®"
    };

    async function scanGames() {
        const desktop = document.getElementById('desktop');
        const loading = document.getElementById('loading-msg');

        try {
            const apiURL = `https://api.github.com/repos/${CONFIG.username}/${CONFIG.repo}/contents/`;
            const response = await fetch(apiURL);
            
            if (!response.ok) throw new Error("æ— æ³•è¯»å–ç›®å½•");
            
            const items = await response.json();
            
            // è¿‡æ»¤æ–‡ä»¶å¤¹
            const folders = items.filter(item => 
                item.type === 'dir' && 
                !CONFIG.exclude.includes(item.name.toLowerCase()) &&
                !item.name.startsWith('.')
            );

            loading.style.display = 'none';
            desktop.innerHTML = '';

            folders.forEach(folder => {
                const name = folder.name;
                const displayName = name.replace(/-/g, ' '); // å°†è¿å­—ç¬¦æ›¿æ¢ä¸ºç©ºæ ¼
                const emoji = ICON_MAP[name.toLowerCase()] || ICON_MAP.default;

                const iconLink = document.createElement('a');
                iconLink.href = `./${name}/index.html`;
                iconLink.className = 'icon';
                iconLink.innerHTML = `
                    <div class="icon-box">${emoji}</div>
                    <span>${displayName}</span>
                `;
                desktop.appendChild(iconLink);
            });

            if (folders.length === 0) {
                loading.innerText = "ç£ç›˜ä¸ºç©º (æœªå‘ç°å­æ–‡ä»¶å¤¹)";
                loading.style.display = 'block';
            }

        } catch (error) {
            console.error(error);
            loading.innerText = "ç³»ç»Ÿé”™è¯¯ï¼šæ— æ³•åŠ è½½æ¸¸æˆåˆ—è¡¨";
        }
    }

    // æ—¶é’ŸåŠŸèƒ½
    function updateClock() {
        const now = new Date();
        document.getElementById('clock').innerText = now.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
    }

    setInterval(updateClock, 1000);
    updateClock();
    scanGames();
</script>

</body>
</html>